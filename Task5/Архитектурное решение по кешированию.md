### Мотивация

Причины внедрения механизма кеширования:

### 1. Низкая скорость работы интерфейса MES

Замедления возникают при операциях, которые обращаются к данным в MES-DB 3D Storage:

- начало обработки заказа;
- обновление статуса заказа в работе;
- открытие 3D-модели заказа.

### 2. Недовольство новых клиентов временем выполнения заказа

Часть задержек связана с потерей данных из-за логических ошибок и блокировками заказов в очередях. Эти проблемы будут устранены в рамках мероприятий, описанных ранее.

Если после исправлений скорость обработки останется недостаточной, прежде чем масштабировать сервисы, необходимо выявить участки с повторными обращениями к одинаковым данным и закешировать их.

### Предлагаемый подход

#### Клиентский кеш

После того как оператор берет заказ в работу, все сведения о заказе помещаются в локальный кеш. Период хранения (_max-age_) определяется как среднее время непрерывной работы оператора над заказом.

Параметры, которые могут изменяться системой, должны обновляться с использованием заголовка `no-cache`, принуждающего клиент получать новые данные.

### Серверный кеш

Серверное кеширование применяется к списку заказов, чтобы ускорить работу MES API.

Оптимальный паттерн - **Refresh-ahead**, обеспечивающий заблаговременное обновление данных и постоянную доступность актуального списка заказов.

Паттерны **Cache-Aside** и **Write-Through** в данной ситуации менее эффективны, поскольку интенсивность изменений со стороны CRM сопоставима с частотой чтения со стороны MES. Кроме того, быстрый доступ к данным конкретного заказа уже обеспечивается клиентским кешем.

### Диаграммы последовательности

#### Чтение списка заказов

Сущности:

- Заказ
- Детали заказа (имя параметра, значение)
- Статус заказа
- Событие изменения статуса

[Схема](read-order.puml)

### Запись изменения статуса заказа

[Схема](write-order.puml)

---

## Стратегии инвалидации

| Временная                               |                  По ключу                   | Прочие                          |
| --------------------------------------- | :-----------------------------------------: | ------------------------------- |
| Используется на клиенте                 |        Применяется к серверному кешу        | Не решают задачи текущего кейса |
| Кеш действует в период работы оператора | Обновление по событиям, связанным с заказом | -                               |
